MODULE FTEST3;
(*
  REVISION HISTORY
  ----------------
  5 Apr 88 -- Modified this file testing module for M2 V 3.03.
  27 Dec 91 -- Converted to M2 V 4.00.
*)
  IMPORT Break;
  IMPORT MED;
  FROM Terminal IMPORT ReadString;
  FROM InOut IMPORT ReadCard,Read,WriteString,WriteLn,WriteCard,WriteInt;
  FROM DiskFiles IMPORT GETFH;
  FROM UTILLIB IMPORT MAXCARD,MAXINT,BUFSIZ,BUFTYP,STRTYP,STR10TYP,
    ASSIGN2BUF,ISDGT,STRCMPFNT,GETFNM,LCHINBUFFNT,MAXCARDFNT,MRGBUFS;
  FROM TOKENIZE IMPORT FSATYP,DELIMCH,INI3TKN,GETTKN;
  FROM FIO IMPORT EOFMARKER,DRIVESEP,SUBDIRSEP,EXTRACTDRVPTH,MYFILTYP,
    IOSTATE,FRESET,FPURGE,FCLOSE,FREAD,FRDTXLN,FWRTX,FWRTXLN,RETBLKBUF,
    FWRSTR,FWRLN,FCLOSEDUP,COPYDPIF,FAPPEND;

VAR
  C,K,I,J,IDX,PTR                              : CARDINAL;
  CH                                           : CHAR;
  FLAG,FLAG2,FLAG3,FLAG4,FLAG5,EOFFLG          : BOOLEAN;
  PROMPT,NAMDFT,TYPDFT,INFNAM,OUTFNAM,
  TMPBUF,NUMBUF,DRVPATH,INBUF                  : BUFTYP;
  SUM                                          : INTEGER;
  INUNT1,OUTUN1                                : MYFILTYP;

BEGIN
  ASSIGN2BUF('ENTER  INPUT FILE NAME : ',PROMPT);
  ASSIGN2BUF('FTEST3.TXT',NAMDFT);
  ASSIGN2BUF('.TXT',TYPDFT);
  GETFNM(PROMPT,NAMDFT,TYPDFT,INFNAM);

  ASSIGN2BUF('ENTER OUTPUT FILE NAME : ',PROMPT);
  ASSIGN2BUF('WORDFILE.DOC',NAMDFT);
  ASSIGN2BUF('.DOC',TYPDFT);
  GETFNM(PROMPT, NAMDFT, TYPDFT, OUTFNAM); 
  
  FRESET(INUNT1,INFNAM,RD);

  COPYDPIF(INFNAM,OUTFNAM);
  FAPPEND(OUTUN1,OUTFNAM);

  WriteString('  FTEST3 INPUT FILE : '); 
  WriteString(INFNAM.CHARS);
  WriteString(', INFNAM.COUNT = ');
  WriteCard(INFNAM.COUNT,0);
  WriteLn;
  WriteString(' OUTPUT FILE : ');
  WriteString(OUTFNAM.CHARS); 
  WriteLn;

  C := 1;
  LOOP (* TO READ MULTIPLE LINES *)
    FRDTXLN(INUNT1,INBUF,EOFFLG);
    IF EOFFLG THEN EXIT END(*IF*);
    WriteString(INBUF.CHARS);
    WriteLn;
    FWRTXLN(OUTUN1,INBUF);
    IF C MOD 10 = 0 THEN
      WriteString(' Press any key to continue.');
      Read(CH);
      IF (CAP(CH) = 'E') OR (CAP(CH) = 'Q') THEN EXIT; END(*IF*);
      WriteLn;
      FCLOSE(OUTUN1);
      FAPPEND(OUTUN1,OUTFNAM);
    END(*IF*);
    INC(C);
  END(*LOOP*);
  FCLOSE(INUNT1);
  FCLOSE(OUTUN1);
  HALT;
END FTEST3.

